# Pull Request é¢„è§ˆéƒ¨ç½²
# ä¸ºæ¯ä¸ª PR åˆ›å»ºé¢„è§ˆç¯å¢ƒ

name: Preview Deployment

on:
    pull_request:
        types: [opened, synchronize, reopened]
        branches:
            - main
            - master

env:
    NODE_VERSION: "20"
    PNPM_VERSION: "8"

jobs:
    preview:
        name: åˆ›å»ºé¢„è§ˆéƒ¨ç½²
        runs-on: ubuntu-latest
        if: false # è®¾ç½®ä¸º true å¯ç”¨

        steps:
            - name: æ£€å‡ºä»£ç 
              uses: actions/checkout@v4

            - name: è®¾ç½® pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: ${{ env.PNPM_VERSION }}

            - name: è®¾ç½® Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: ${{ env.NODE_VERSION }}
                  cache: "pnpm"

            - name: å®‰è£…ä¾èµ–
              run: pnpm install --frozen-lockfile

            - name: æ„å»ºåº”ç”¨
              run: pnpm run build

            - name: éƒ¨ç½²é¢„è§ˆåˆ° Vercel
              uses: amondnet/vercel-action@v25
              id: vercel-deploy
              with:
                  vercel-token: ${{ secrets.VERCEL_TOKEN }}
                  vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
                  vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
                  github-token: ${{ secrets.GITHUB_TOKEN }}
                  github-comment: true

            - name: è¯„è®º PR
              uses: actions/github-script@v7
              with:
                  script: |
                      github.rest.issues.createComment({
                        issue_number: context.issue.number,
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        body: `ğŸ‰ é¢„è§ˆéƒ¨ç½²æˆåŠŸï¼\n\né¢„è§ˆåœ°å€: ${{ steps.vercel-deploy.outputs.preview-url }}`
                      })
